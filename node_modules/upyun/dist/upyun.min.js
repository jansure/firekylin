/**
  * UPYUN js-sdk 3.3.6
  * (c) 2019
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):e.upyun=t(e.axios)}(this,function(c){"use strict";c="default"in c?c.default:c;var h="undefined"!=typeof window&&("undefined"==typeof process||"browser"===process.title),a=1048576,e=c.defaults.adapter;c.defaults.adapter=h?e:require("axios/lib/adapters/http");var v={readBlockAsync:function(n,o,i){return new Promise(function(e,t){var r=n.slice||n.mozSlice||n.webkitSlice;return r?e(r.call(n,o,i)):t(new Error("not support File type!"))})}};var u=function(e,t,i,a){function w(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function k(e,t){return e<<t|e>>>32-t}function s(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r,n,o,i,u,a=[80],s=1732584193,l=-271733879,c=-1732584194,f=271733878,h=-1009589776,v=0;v<e.length;v+=16){for(var d=s,p=l,y=c,g=f,m=h,b=0;b<80;b++){a[b]=b<16?e[v+b]:k(a[b-3]^a[b-8]^a[b-14]^a[b-16],1);var x=w(w(k(s,5),(o=l,i=c,u=f,(n=b)<20?o&i|~o&u:n<40?o^i^u:n<60?o&i|o&u|i&u:o^i^u)),w(w(h,a[b]),(r=b)<20?1518500249:r<40?1859775393:r<60?-1894007588:-899497514));h=f,f=c,c=k(l,30),l=s,s=x}s=w(s,d),l=w(l,p),c=w(c,y),f=w(f,g),h=w(h,m)}return[s,l,c,f,h]}function l(e){for(var t=[],r=(1<<a)-1,n=0;n<e.length*a;n+=a)t[n>>5]|=(e.charCodeAt(n/8)&r)<<32-a-n%32;return t}return i||(i="="),a||(a=8),function(e){for(var t="",r=0;r<4*e.length;r+=3)for(var n=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,o=0;o<4;o++)8*r+6*o>32*e.length?t+=i:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-o)&63);return t}(function(e,t){var r=l(e);16<r.length&&(r=s(r,e.length*a));for(var n=[16],o=[16],i=0;i<16;i++)n[i]=909522486^r[i],o[i]=1549556828^r[i];var u=s(n.concat(l(t)),512+t.length*a);return s(o.concat(u),672)}(e,t))},d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=t(function(s,f){!function(e){var t=f,r=s&&s.exports==t&&s,n="object"==typeof d&&d;n.global!==n&&n.window!==n||(e=n);var o=function(e){this.message=e};(o.prototype=new Error).name="InvalidCharacterError";var l=function(e){throw new o(e)},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=/[\t\n\f\r ]/g,i={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&l("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,o,i=e.length%3,u="",a=-1,s=e.length-i;++a<s;)t=e.charCodeAt(a)<<16,r=e.charCodeAt(++a)<<8,n=e.charCodeAt(++a),u+=c.charAt((o=t+r+n)>>18&63)+c.charAt(o>>12&63)+c.charAt(o>>6&63)+c.charAt(63&o);return 2==i?(t=e.charCodeAt(a)<<8,r=e.charCodeAt(++a),u+=c.charAt((o=t+r)>>10)+c.charAt(o>>4&63)+c.charAt(o<<2&63)+"="):1==i&&(o=e.charCodeAt(a),u+=c.charAt(o>>2)+c.charAt(o<<4&63)+"=="),u},decode:function(e){var t=(e=String(e).replace(a,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&l("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,o=0,i="",u=-1;++u<t;)n=c.indexOf(e.charAt(u)),r=o%4?64*r+n:n,o++%4&&(i+=String.fromCharCode(255&r>>(-2*o&6)));return i},version:"0.1.0"};if(t&&!t.nodeType)if(r)r.exports=i;else for(var u in i)i.hasOwnProperty(u)&&(t[u]=i[u]);else e.base64=i}(d)}),i="3.3.6",r=t(function(e){var i,r;i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];0<e;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3)for(var n=e[r]<<16|e[r+1]<<8|e[r+2],o=0;o<4;o++)8*r+6*o<=8*e.length?t.push(i.charAt(n>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,n=0;r<e.length;n=++r%4)0!=n&&t.push((i.indexOf(e.charAt(r-1))&Math.pow(2,-2*n+8)-1)<<2*n|i.indexOf(e.charAt(r))>>>6-2*n);return t}},e.exports=r}),o={utf8:{stringToBytes:function(e){return o.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(o.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}},s=o,l=function(e){return null!=e&&(f(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&f(t.slice(0,0))||!!e._isBuffer);var t};function f(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var p=t(function(e){var g,m,b,x,w;g=r,m=s.utf8,b=l,x=s.bin,(w=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?x.stringToBytes(e):m.stringToBytes(e):b(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var r=g.bytesToWords(e),n=8*e.length,o=1732584193,i=-271733879,u=-1732584194,a=271733878,s=0;s<r.length;s++)r[s]=16711935&(r[s]<<8|r[s]>>>24)|4278255360&(r[s]<<24|r[s]>>>8);r[n>>>5]|=128<<n%32,r[14+(n+64>>>9<<4)]=n;var l=w._ff,c=w._gg,f=w._hh,h=w._ii;for(s=0;s<r.length;s+=16){var v=o,d=i,p=u,y=a;i=h(i=h(i=h(i=h(i=f(i=f(i=f(i=f(i=c(i=c(i=c(i=c(i=l(i=l(i=l(i=l(i,u=l(u,a=l(a,o=l(o,i,u,a,r[s+0],7,-680876936),i,u,r[s+1],12,-389564586),o,i,r[s+2],17,606105819),a,o,r[s+3],22,-1044525330),u=l(u,a=l(a,o=l(o,i,u,a,r[s+4],7,-176418897),i,u,r[s+5],12,1200080426),o,i,r[s+6],17,-1473231341),a,o,r[s+7],22,-45705983),u=l(u,a=l(a,o=l(o,i,u,a,r[s+8],7,1770035416),i,u,r[s+9],12,-1958414417),o,i,r[s+10],17,-42063),a,o,r[s+11],22,-1990404162),u=l(u,a=l(a,o=l(o,i,u,a,r[s+12],7,1804603682),i,u,r[s+13],12,-40341101),o,i,r[s+14],17,-1502002290),a,o,r[s+15],22,1236535329),u=c(u,a=c(a,o=c(o,i,u,a,r[s+1],5,-165796510),i,u,r[s+6],9,-1069501632),o,i,r[s+11],14,643717713),a,o,r[s+0],20,-373897302),u=c(u,a=c(a,o=c(o,i,u,a,r[s+5],5,-701558691),i,u,r[s+10],9,38016083),o,i,r[s+15],14,-660478335),a,o,r[s+4],20,-405537848),u=c(u,a=c(a,o=c(o,i,u,a,r[s+9],5,568446438),i,u,r[s+14],9,-1019803690),o,i,r[s+3],14,-187363961),a,o,r[s+8],20,1163531501),u=c(u,a=c(a,o=c(o,i,u,a,r[s+13],5,-1444681467),i,u,r[s+2],9,-51403784),o,i,r[s+7],14,1735328473),a,o,r[s+12],20,-1926607734),u=f(u,a=f(a,o=f(o,i,u,a,r[s+5],4,-378558),i,u,r[s+8],11,-2022574463),o,i,r[s+11],16,1839030562),a,o,r[s+14],23,-35309556),u=f(u,a=f(a,o=f(o,i,u,a,r[s+1],4,-1530992060),i,u,r[s+4],11,1272893353),o,i,r[s+7],16,-155497632),a,o,r[s+10],23,-1094730640),u=f(u,a=f(a,o=f(o,i,u,a,r[s+13],4,681279174),i,u,r[s+0],11,-358537222),o,i,r[s+3],16,-722521979),a,o,r[s+6],23,76029189),u=f(u,a=f(a,o=f(o,i,u,a,r[s+9],4,-640364487),i,u,r[s+12],11,-421815835),o,i,r[s+15],16,530742520),a,o,r[s+2],23,-995338651),u=h(u,a=h(a,o=h(o,i,u,a,r[s+0],6,-198630844),i,u,r[s+7],10,1126891415),o,i,r[s+14],15,-1416354905),a,o,r[s+5],21,-57434055),u=h(u,a=h(a,o=h(o,i,u,a,r[s+12],6,1700485571),i,u,r[s+3],10,-1894986606),o,i,r[s+10],15,-1051523),a,o,r[s+1],21,-2054922799),u=h(u,a=h(a,o=h(o,i,u,a,r[s+8],6,1873313359),i,u,r[s+15],10,-30611744),o,i,r[s+6],15,-1560198380),a,o,r[s+13],21,1309151649),u=h(u,a=h(a,o=h(o,i,u,a,r[s+4],6,-145523070),i,u,r[s+11],10,-1120210379),o,i,r[s+2],15,718787259),a,o,r[s+9],21,-343485551),o=o+v>>>0,i=i+d>>>0,u=u+p>>>0,a=a+y>>>0}return g.endian([o,i,u,a])})._ff=function(e,t,r,n,o,i,u){var a=e+(t&r|~t&n)+(o>>>0)+u;return(a<<i|a>>>32-i)+t},w._gg=function(e,t,r,n,o,i,u){var a=e+(t&n|r&~n)+(o>>>0)+u;return(a<<i|a>>>32-i)+t},w._hh=function(e,t,r,n,o,i,u){var a=e+(t^r^n)+(o>>>0)+u;return(a<<i|a>>>32-i)+t},w._ii=function(e,t,r,n,o,i,u){var a=e+(r^(t|~n))+(o>>>0)+u;return(a<<i|a>>>32-i)+t},w._blocksize=16,w._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=g.wordsToBytes(w(e,t));return t&&t.asBytes?r:t&&t.asString?x.bytesToString(r):g.bytesToHex(r)}});function y(e,t){var r=t.method,n=t.path,o=[r,encodeURI(n)];["date","policy","contentMd5"].forEach(function(e){t[e]&&o.push(t[e])});var i=u(e.password,o.join("&"));return"UPYUN "+e.operatorName+":"+i}var g={genSign:y,getHeaderSign:function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=(new Date).toGMTString();return{Authorization:y(e,{method:t,path:r="/"+e.serviceName+r,date:o,contentMd5:n}),"X-Date":o}},getPolicyAndAuthorization:function(e,t){if(t.service=e.serviceName,void 0===t["save-key"])throw new Error("upyun - calclate body sign need save-key");void 0===t.expiration&&(t.expiration=parseInt(new Date/1e3+1800,10));var r=n.encode(JSON.stringify(t));return{policy:r,authorization:y(e,{method:"POST",path:"/"+e.serviceName,policy:r})}},getPurgeHeaderSign:function(e,t){var r=(new Date).toGMTString(),n=t.join("\n"),o=p(n+"&"+e.serviceName+"&"+r+"&"+e.password);return{Authorization:"UpYun "+e.serviceName+":"+e.operatorName+":"+o,Date:r,"User-Agent":"Js-Sdk/"+i}}},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},b=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),x=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function w(e){return 0===e.indexOf("x-upyun-meta-")}function k(){var e=g.getHeaderSign.apply(g,arguments);return Promise.resolve(e)}var S=function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";m(this,e),this.bucketName=t,this.serviceName=this.bucketName,this.operatorName=r,this.password=p(n)};return{Client:function(){function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(m(this,s),void 0===e.serviceName)throw new Error("upyun - must config serviceName");if("function"==typeof t&&(r=t,t={}),"function"!=typeof r&&h)throw new Error("upyun - must config a callback function getHeaderSign in client side");if(!h&&(void 0===e.operatorName||void 0===e.password))throw new Error("upyun - must config operateName and password in server side");var n,o,i,u,a=Object.assign({domain:"v0.api.upyun.com",protocol:"https"},t);this.endpoint=a.protocol+"://"+a.domain,this.req=(n=this.endpoint,o=e,i=r||k,(u=c.create({baseURL:n+"/"+o.serviceName,maxRedirects:0})).interceptors.request.use(function(t){var e=t.method.toUpperCase(),r=t.url;return 0===t.url.indexOf(t.baseURL)&&(r=t.url.substring(t.baseURL.length)),t.url=encodeURI(t.url),i(o,e,r,t.headers["Content-MD5"]).then(function(e){return t.headers.common=e,Promise.resolve(t)})},function(e){throw new Error("upyun - request failed: "+e.message)}),u.interceptors.response.use(function(e){return e},function(e){var t=e.response;if(void 0===t)throw e;if(404!==t.status)throw new Error("upyun - response error: "+e.message);return t}),u),this.bucket=e,this.service=e,h||this.setBodySignCallback(g.getPolicyAndAuthorization)}return b(s,[{key:"setService",value:function(e){this.service=e,this.req.defaults.baseURL=this.endpoint+"/"+e.serviceName}},{key:"setBucket",value:function(e){return this.setService(e)}},{key:"setBodySignCallback",value:function(e){if("function"!=typeof e)throw new Error("upyun - getBodySign should be a function");this.bodySignCallback=e}},{key:"usage",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"/";return this.req.get(e+"?usage").then(function(e){var t=e.data;return Promise.resolve(t)})}},{key:"listDir",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"/",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.limit,n=void 0===r?100:r,o=t.order,i=void 0===o?"asc":o,u=t.iter,a=void 0===u?"":u,s={};return 100!==n&&(s["x-list-limit"]=n),"asc"!==i&&(s["x-list-order"]=i),a&&(s["x-list-iter"]=a),this.req.get(e,{headers:s}).then(function(e){var t=e.data,r=e.headers;if(404===e.status)return!1;var n=r["x-upyun-list-iter"];if(!t)return Promise.resolve({files:[],next:n});var o=t.split("\n").map(function(e){var t=e.split("\t"),r=x(t,4),n=r[0],o=r[1],i=r[2],u=r[3];return{name:n,type:o,size:parseInt(i),time:parseInt(u)}});return Promise.resolve({files:o,next:n})})}},{key:"putFile",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=["Content-MD5","Content-Length","Content-Type","Content-Secret","x-gmkerl-thumb"],o={},i={},u=!0,a=!1,s=void 0;try{for(var l,c=Object.keys(r)[Symbol.iterator]();!(u=(l=c.next()).done);u=!0){var f=l.value;i[f.toLowerCase()]=r[f]}}catch(e){a=!0,s=e}finally{try{!u&&c.return&&c.return()}finally{if(a)throw s}}var h=!0,v=!1,d=void 0;try{for(var p,y=Object.keys(i)[Symbol.iterator]();!(h=(p=y.next()).done);h=!0){var g=p.value;w(g)&&i[g]?o[g]=i[g]:n.forEach(function(e){var t=e.toLowerCase(),r=i[t];r&&(o[e]=r)})}}catch(e){v=!0,d=e}finally{try{!h&&y.return&&y.return()}finally{if(v)throw d}}return this.req.put(e,t,{headers:o}).then(function(e){var r=e.headers;if(200!==e.status)return Promise.resolve(!1);var n={};return["x-upyun-width","x-upyun-height","x-upyun-file-type","x-upyun-frames"].forEach(function(e){var t=e.split("x-upyun-")[1];r[e]&&(n[t]=r[e],"file-type"!==t&&(n[t]=parseInt(n[t],10)))}),Promise.resolve(!(0<Object.keys(n).length)||n)})}},{key:"initMultipartUpload",value:function(e,t){var r=this,n=void 0,o=function(e){var t={},r=!0,n=!1,o=void 0;try{for(var i,u=Object.keys(e)[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var a=i.value;t[a.toLowerCase()]=e[a]}}catch(e){n=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw o}}return t}(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}),i=o["x-upyun-multi-type"];return i=h?(n=Promise.resolve(t.size),i||t.type):(n=v.getFileSizeAsync(t),i||v.getContentType(t)),n.then(function(n){return Object.assign(o,{"x-upyun-multi-disorder":!0,"x-upyun-multi-stage":"initiate","x-upyun-multi-length":n,"x-upyun-multi-type":i}),r.req.put(e,null,{headers:o}).then(function(e){var t=e.headers;if(204!==e.status)return Promise.resolve(!1);var r=t["x-upyun-multi-uuid"];return Promise.resolve({fileSize:n,partCount:Math.ceil(n/a),uuid:r})})})}},{key:"multipartUpload",value:function(t,r,n,o){var i=this,u=o*a,e=void 0;return h?(e=Promise.resolve(r.size),r.type):(e=v.getFileSizeAsync(r),v.getContentType(r)),e.then(function(e){var t=Math.min(u+a,e);return v.readBlockAsync(r,u,t)}).then(function(e){return i.req.put(t,e,{headers:{"x-upyun-multi-stage":"upload","x-upyun-multi-uuid":n,"x-upyun-part-id":o}}).then(function(e){var t=e.status;return Promise.resolve(204===t)})})}},{key:"completeMultipartUpload",value:function(e,t){return this.req.put(e,null,{headers:{"x-upyun-multi-stage":"complete","x-upyun-multi-uuid":t}}).then(function(e){var t=e.status;return Promise.resolve(204===t||201===t)})}},{key:"makeDir",value:function(e){return this.req.post(e,null,{headers:{folder:"true"}}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"headFile",value:function(e){return this.req.head(e).then(function(e){var r=e.headers;if(404===e.status)return Promise.resolve(!1);var n={};return["x-upyun-file-type","x-upyun-file-size","x-upyun-file-date","Content-Md5"].forEach(function(e){var t=e.split("x-upyun-file-")[1];r[e]&&(n[t]=r[e],"size"!==t&&"date"!==t||(n[t]=parseInt(n[t],10)))}),Promise.resolve(n)})}},{key:"deleteFile",value:function(e){var t={};return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&(t["x-upyun-async"]=!0),this.req.delete(e,{headers:t}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"deleteDir",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.deleteFile.apply(this,t)}},{key:"getFile",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t&&h)throw new Error("upyun - save as stream are only available on the server side.");return this.req({method:"GET",url:e,responseType:t?"stream":null}).then(function(e){if(404===e.status)return Promise.resolve(!1);if(!t)return Promise.resolve(e.data);var r=e.data.pipe(t);return new Promise(function(e,t){r.on("finish",function(){return e(r)}),r.on("error",t)})})}},{key:"updateMetadata",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"merge",n={};for(var o in t)w(o)?n[o]=t:n["x-upyun-meta-"+o]=t[o];return this.req.patch(e+"?metadata="+r,null,{headers:n}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"getMetadata",value:function(e){return this.req.get(e).then(function(e){var t=e.headers;if(200!==e.status)return Promise.resolve(!1);var r={};for(var n in t)w(n)&&(r[n]=t[n]);return Promise.resolve(r)})}},{key:"blockUpload",value:function(l,c){var f=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t=void 0,r=void 0;return r=h?(t=Promise.resolve(c.size),c.type):(t=v.getFileSizeAsync(c),v.getContentType(c)),t.then(function(u){Object.assign(e,{"x-upyun-multi-stage":"initiate","x-upyun-multi-length":u,"x-upyun-multi-type":r});var a=1048576,s=Math.ceil(u/a);return f.req.put(l,null,{headers:e}).then(function(e){for(var t=e.headers,n=t["x-upyun-multi-uuid"],r=t["x-upyun-next-part-id"],o=Promise.resolve(r),i=0;i<s;i++)o=o.then(function(r){var e=r*a,t=Math.min(e+a,u);return v.readBlockAsync(c,e,t).then(function(e){return f.req.put(l,e,{headers:{"x-upyun-multi-stage":"upload","x-upyun-multi-uuid":n,"x-upyun-part-id":r}}).then(function(e){var t=e.headers;return r=t["x-upyun-next-part-id"],Promise.resolve(r)})})});return o.then(function(){return f.req.put(l,null,{headers:{"x-upyun-multi-stage":"complete","x-upyun-multi-uuid":n}}).then(function(e){var t=e.status;return Promise.resolve(204===t||201===t)})})})})}},{key:"formPutFile",value:function(e,a){var s=this,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("function"!=typeof this.bodySignCallback)throw new Error("upyun - must setBodySignCallback first!");l.service=this.service.serviceName,l["save-key"]=e;var t=this.bodySignCallback(this.service,l);return"function"!=typeof t.then&&(t=Promise.resolve(t)),t.then(function(e){return(t=s.endpoint+"/"+l.service,r=a,n=e,o=n.authorization,i=n.policy,u=new FormData,u.append("authorization",o),u.append("policy",i),"string"==typeof r&&(r=new Blob([r],{type:"text/plain"})),u.append("file",r),c.post(t,u).then(function(e){var t=e.status,r=e.data;return 200===t&&Promise.resolve(r)})).then(function(e){return Promise.resolve(e)});var t,r,n,o,i,u})}},{key:"purge",value:function(e){"string"==typeof e&&(e=[e]);var t=g.getPurgeHeaderSign(this.service,e);return c.post("http://purge.upyun.com/purge/","purge="+e.join("\n"),{headers:t}).then(function(e){var t=e.data;if(0===Object.keys(t.invalid_domain_of_url).length)return!0;throw new Error("some url purge failed "+t.invalid_domain_of_url.join(" "))},function(e){throw new Error("upyun - request failed: "+e.message)})}}]),s}(),sign:g,Bucket:S,Service:S}});